<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Success | SATPL 2026</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .success-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .success-card {
            max-width: 500px;
            padding: 60px 40px;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .reg-number-box {
            margin: 30px 0;
            padding: 20px;
            background: var(--glass-bg);
            border-radius: 12px;
            border: 1px dashed var(--secondary);
        }

        #regNo {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: 2px;
            color: var(--secondary);
        }
    </style>
</head>

<body>

    <div class="success-wrapper">
        <div class="success-card glass animate-fade">
            <span class="success-icon">ðŸŽ‰</span>
            <h2 class="gradient-text" style="font-size: 2.5rem; margin-bottom: 10px;">Thank You for Registering!</h2>
            <p style="color: var(--text-dim);">Welcome to the SATPL 2026 family. Your registration has been confirmed.
            </p>

            <div class="reg-number-box">
                <p style="font-size: 0.9rem; margin-bottom: 5px; color: var(--text-dim);">Your Registration Number</p>
                <div id="regNo">Loading...</div>
            </div>

            <div id="id-card-wrap" style="display: none;">
                <!-- Premium ID Card Design -->
                <div id="player-id-card"
                    style="width: 350px; height: 500px; background: #050816; border: 2px solid #ff0055; border-radius: 20px; position: relative; overflow: hidden; margin: 0 auto; color: white; font-family: 'Outfit', sans-serif;">
                    <div
                        style="position: absolute; top: -50px; left: -50px; width: 150px; height: 150px; background: rgba(255, 0, 85, 0.2); border-radius: 50%; filter: blur(30px);">
                    </div>
                    <div
                        style="position: absolute; bottom: -50px; right: -50px; width: 150px; height: 150px; background: rgba(0, 242, 255, 0.2); border-radius: 50%; filter: blur(30px);">
                    </div>

                    <div style="padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="font-size: 1.2rem; letter-spacing: 2px; color: #ff0055; margin: 0;">SATPL 2026</h3>
                        <p style="font-size: 0.6rem; color: #00f2ff; margin: 5px 0 0;">OFFICIAL PLAYER ID</p>
                    </div>

                    <div style="padding: 30px 20px; text-align: center;">
                        <img id="card-photo" src="https://via.placeholder.com/120"
                            style="width: 120px; height: 120px; border-radius: 15px; border: 3px solid #ff0055; object-fit: cover; margin-bottom: 15px;">
                        <h4 id="card-name" style="font-size: 1.5rem; margin: 0; text-transform: uppercase;">PLAYER NAME
                        </h4>
                        <p id="card-role" style="font-size: 0.8rem; color: #a0a0c0; margin: 5px 0;">Allrounder</p>
                    </div>

                    <div
                        style="background: rgba(255,255,255,0.05); margin: 0 20px; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1);">
                        <p style="font-size: 0.6rem; color: #a0a0c0; text-transform: uppercase; margin: 0;">Registration
                            ID</p>
                        <p id="card-reg-no"
                            style="font-size: 1.1rem; font-weight: 800; color: #00f2ff; letter-spacing: 1px; margin: 5px 0 0;">
                            SATPL001</p>
                    </div>

                    <div style="position: absolute; bottom: 15px; width: 100%; text-align: center;">
                        <img src="https://via.placeholder.com/50" style="width: 50px; opacity: 0.5;">
                        <p style="font-size: 0.5rem; color: #a0a0c0; margin-top: 5px;">Valid for SATPL Season 2026</p>
                    </div>
                </div>
            </div>

            <div style="margin-top: 40px; display: flex; flex-direction: column; gap: 15px;">
                <button id="downloadBtn" class="btn btn-red-blink" onclick="downloadIDCard()"
                    style="display: none;">Download Digital ID Card ðŸ“¥</button>
                <a href="index.html" class="btn">Back to Home</a>
                <p style="font-size: 0.8rem; color: var(--text-dim);">A copy of this registration has been sent to our
                    admin team.</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const regNo = params.get("reg_no");

        async function initSuccess() {
            if (!regNo) {
                document.getElementById("regNo").innerText = "Not Found";
                return;
            }
            document.getElementById("regNo").innerText = regNo;

            // Fetch player details for ID card
            const { data, error } = await supabaseClient
                .from('player_registrations')
                .select('*')
                .eq('registration_no', regNo)
                .single();

            if (data) {
                document.getElementById('card-name').innerText = data.player_name;
                document.getElementById('card-reg-no').innerText = data.registration_no;
                document.getElementById('card-photo').src = data.photo_url || 'https://via.placeholder.com/120';

                let role = "Allrounder";
                if (data.batting !== 'no' && data.bowling === 'no') role = "Batsman";
                else if (data.batting === 'no' && data.bowling !== 'no') role = "Bowler";
                if (data.wicket_keeper === 'yes' || data.wicket_keeper === true) role += " & WK";
                document.getElementById('card-role').innerText = role;

                document.getElementById('downloadBtn').style.display = 'block';
                document.getElementById('id-card-wrap').style.display = 'block';
            }
        }

        async function downloadIDCard() {
            const btn = document.getElementById('downloadBtn');
            btn.innerText = "â³ Generating Image...";
            btn.disabled = true;

            const card = document.getElementById('player-id-card');

            // Wait for image to load
            const img = document.getElementById('card-photo');
            if (img.complete) {
                capture();
            } else {
                img.onload = capture;
            }

            function capture() {
                html2canvas(card, {
                    scale: 3, // High quality
                    useCORS: true, // Allow external images (Supabase storage)
                    backgroundColor: "#050816"
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `SATPL_ID_${regNo}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                    btn.innerText = "Download Digital ID Card ðŸ“¥";
                    btn.disabled = false;
                });
            }
        }

        initSuccess();
    </script>

</body>

</html>
